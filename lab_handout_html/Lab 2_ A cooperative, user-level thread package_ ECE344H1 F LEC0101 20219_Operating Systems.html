<!DOCTYPE html>
<html dir="ltr"   lang="en-CA">
<head>
  <meta charset="utf-8">
  <meta name="sentry-trace" content="448625aa73e847b2b1adbebd1d0d1e6c-34b0a65d776e4277-0"/>
  <link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/fonts/lato/extended/Lato-Regular-bd03a2cc27.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/fonts/lato/extended/Lato-Bold-cccb897485.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/fonts/lato/extended/Lato-Italic-4eb103b4d1.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/no_variables/bundles/fonts-6ee09b0b2f.css" media="screen" />
    <script>if (navigator.userAgent.match(/(MSIE|Trident\/)/)) location.replace('/ie-is-not-supported.html')</script>
  
  <link rel="icon" type="image/x-icon" href="https://du11hjcvx0uqb.cloudfront.net/dist/images/favicon-e10d657a73.ico" />
  <link rel="apple-touch-icon" href="https://du11hjcvx0uqb.cloudfront.net/dist/images/apple-touch-icon-585e5d997d.png" />
  <link rel="stylesheet" href="https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/0976b3638d0604c8fdc3c2118e22f3cf/variables-7dd4b80918af0e0218ec0229e4bd5873.css" media="all" />
  <link rel="stylesheet" href="https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/new_styles_normal_contrast/bundles/common-c5d9e08ec7.css" media="all" />
  <meta name="apple-itunes-app" content="app-id=480883488">
<link rel="manifest" href="/web-app-manifest/manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#002a5c">
  <meta name="robots" content="noindex,nofollow" />
  <link rel="stylesheet" href="https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/new_styles_normal_contrast/bundles/wiki_page-bb0c0c1f96.css" media="all" />
<link rel="stylesheet" href="https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/new_styles_normal_contrast/bundles/new_user_tutorials-2950c871dd.css" media="all" />
  <link rel="stylesheet" href="https://instructure-uploads-yul.s3.ca-central-1.amazonaws.com/account_118340000000000001/attachments/434590/uoft-new.css" media="all" />


  <script>
    INST = {"environment":"production","allowMediaComments":true,"kalturaSettings":{"domain":"yul.nv.instructuremedia.com","resource_domain":"yul.nv.instructuremedia.com","rtmp_domain":"yul.rtmp.instructuremedia.com","partner_id":7,"subpartner_id":0,"player_ui_conf":0,"kcw_ui_conf":0,"upload_ui_conf":0,"max_file_size_bytes":534773760,"js_uploader":"yes"},"disableGooglePreviews":true,"logPageViews":true,"editorButtons":[{"name":"YouTube","id":50,"favorite":false,"url":"https://www.edu-apps.org/lti_public_resources/?tool_id=youtube","icon_url":"https://www.edu-apps.org/assets/lti_public_resources/youtube_icon.png","canvas_icon_class":null,"width":560,"height":600,"use_tray":false,"description":"\u003cp\u003eSearch publicly available YouTube videos. A new icon will show up in your course rich editor letting you search YouTube and click to embed videos in your course material.\u003c/p\u003e\n"},{"name":"O365 OneDrive","id":5716,"favorite":true,"url":"https://office365-yul-prod.instructure.com/lti/rce-content-item","icon_url":"https://office365-yul-prod.instructure.com/images/office365_icon.png","canvas_icon_class":null,"width":900,"height":600,"use_tray":false,"description":"\u003cp\u003eAllows you to pull in documents from Office 365 OneDrive to Canvas\u003c/p\u003e\n"},{"name":"Insert a Wiley Resource","id":14754,"favorite":false,"url":"https://lti.education.wiley.com/wpng/api/v1/lti/resourcediscoverytool","icon_url":"https://education.wiley.com/assets/images/wp.svg","canvas_icon_class":null,"width":1160,"height":660,"use_tray":false,"description":"\u003cp\u003eOutcomes-based learning.\u003c/p\u003e\n"},{"name":"Import citations","id":17413,"favorite":false,"url":"https://utoronto.alma.exlibrisgroup.com/lti/v3/launch/01UTORONTO_INST/LMS_CANVAS_1","icon_url":"https://utoronto.alma.exlibrisgroup.com/lti/images/editor-btn.png","canvas_icon_class":null,"width":900,"height":650,"use_tray":false,"description":"\u003cp\u003eLibrary Reading List\u003c/p\u003e\n"}]};
    ENV = {"ASSET_HOST":"https://du11hjcvx0uqb.cloudfront.net","active_brand_config_json_url":"https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/0976b3638d0604c8fdc3c2118e22f3cf/variables-7dd4b80918af0e0218ec0229e4bd5873.json","active_brand_config":{"md5":"0976b3638d0604c8fdc3c2118e22f3cf","variables":{"ic-brand-primary":"#002a5c","ic-brand-global-nav-bgd":"#002a5c","ic-brand-global-nav-menu-item__badge-bgd":"#008ee2","ic-brand-global-nav-logo-bgd":"#002a5c","ic-brand-header-image":"https://instructure-uploads-yul.s3.ca-central-1.amazonaws.com/account_118340000000000001/attachments/113470/tree%20logo.png","ic-brand-watermark-opacity":"1","ic-brand-msapplication-tile-wide":"https://instructure-uploads-yul.s3.ca-central-1.amazonaws.com/account_118340000000000001/attachments/113471/tree%20logo.png","ic-brand-right-sidebar-logo":"https://instructure-uploads-yul.s3.ca-central-1.amazonaws.com/account_118340000000000001/attachments/113518/20171219_Quercus-01.png"},"share":false,"name":null,"created_at":"2023-02-06T13:41:17-05:00","js_overrides":"https://instructure-uploads-yul.s3.ca-central-1.amazonaws.com/account_118340000000000001/attachments/24721051/UT_CustomJS_20210412-PRD-GTM.js","css_overrides":"https://instructure-uploads-yul.s3.ca-central-1.amazonaws.com/account_118340000000000001/attachments/434590/uoft-new.css","mobile_js_overrides":"","mobile_css_overrides":"","parent_md5":null},"confetti_branding_enabled":false,"url_to_what_gets_loaded_inside_the_tinymce_editor_css":["https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/0976b3638d0604c8fdc3c2118e22f3cf/variables-7dd4b80918af0e0218ec0229e4bd5873.css","https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/new_styles_normal_contrast/bundles/what_gets_loaded_inside_the_tinymce_editor-a64c7fe33c.css","https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/no_variables/bundles/fonts-6ee09b0b2f.css"],"url_for_high_contrast_tinymce_editor_css":["https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/default/variables-high_contrast-7dd4b80918af0e0218ec0229e4bd5873.css","https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/new_styles_high_contrast/bundles/what_gets_loaded_inside_the_tinymce_editor-fa0672d544.css","https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/no_variables/bundles/fonts-6ee09b0b2f.css"],"current_user_id":"287772","current_user_global_id":"118340000000287772","current_user_heap_id":"uu-2-2c939087a86180dd981cdb601a812aaabef8de0caa5cb2a53c2a39d778d64303-dsWzekD5khhODOqBAcRfXKcKKo0XpVhgmkX973K4","current_user_roles":["user","student","teacher"],"current_user_is_student":false,"current_user_types":[],"current_user_disabled_inbox":false,"current_user_visited_tabs":null,"discussions_reporting":false,"files_domain":"cluster75.canvas-user-content.com","group_information":null,"DOMAIN_ROOT_ACCOUNT_ID":"118340000000000001","DOMAIN_ROOT_ACCOUNT_UUID":"dsWzekD5khhODOqBAcRfXKcKKo0XpVhgmkX973K4","k12":false,"help_link_name":"Help","help_link_icon":"help","use_high_contrast":false,"auto_show_cc":false,"disable_celebrations":false,"disable_keyboard_shortcuts":false,"LTI_LAUNCH_FRAME_ALLOWANCES":["geolocation *","microphone *","camera *","midi *","encrypted-media *","autoplay *","clipboard-write *","display-capture *"],"DEEP_LINKING_POST_MESSAGE_ORIGIN":"https://q.utoronto.ca","DEEP_LINKING_LOGGING":null,"comment_library_suggestions_enabled":false,"SETTINGS":{"open_registration":false,"collapse_global_nav":false,"release_notes_badge_disabled":false},"FULL_STORY_ENABLED":false,"RAILS_ENVIRONMENT":"Production","IN_PACED_COURSE":false,"SENTRY_FRONTEND":{"dsn":"https://355a1d96717e4038ac25aa852fa79a8f@relay-yul.sentry.insops.net/388","org_slug":"instructure","base_url":"https://sentry.insops.net","normalized_route":"/courses/{course_id}/pages/{id}","errors_sample_rate":"0.0005","traces_sample_rate":"0.0005","url_deny_pattern":"instructure-uploads.*amazonaws.com","revision":"canvas-lms@20231025.250"},"DATA_COLLECTION_ENDPOINT":"https://canvas-frontend-data-yul-prod.inscloudgate.net/submit","DOMAIN_ROOT_ACCOUNT_SFID":"001A000000YLIoa","DIRECT_SHARE_ENABLED":false,"CAN_VIEW_CONTENT_SHARES":true,"FEATURES":{"featured_help_links":true,"lti_platform_storage":true,"calendar_series":true,"account_level_blackout_dates":false,"render_both_to_do_lists":false,"course_paces_redesign":true,"course_paces_for_students":true,"module_publish_menu":true,"explicit_latex_typesetting":false,"dev_key_oidc_alert":true,"media_links_use_attachment_id":false,"permanent_page_links":true,"differentiated_modules":false,"enhanced_course_creation_account_fetching":false,"instui_for_import_page":false,"product_tours":false,"usage_rights_discussion_topics":true,"granular_permissions_manage_users":true,"create_course_subaccount_picker":true,"lti_deep_linking_module_index_menu_modal":true,"lti_multiple_assignment_deep_linking":true,"lti_overwrite_user_url_input_select_content_dialog":true,"buttons_and_icons_root_account":true,"extended_submission_state":false,"scheduled_page_publication":true,"send_usage_metrics":false,"rce_transform_loaded_content":false,"lti_assignment_page_line_items":true,"mobile_offline_mode":false,"react_discussions_post":false,"instui_nav":false,"embedded_release_notes":false,"canvas_k6_theme":false,"new_math_equation_handling":true},"current_user":{"id":"287772","anonymous_id":"661o","display_name":"Yuhe Chen","avatar_image_url":"https://q.utoronto.ca/images/thumbnails/24252802/49w46JOhPyJJXYU3xUiBG9eUG1LciFpubMN3YR4t","html_url":"https://q.utoronto.ca/about/287772","pronouns":null,"avatar_is_fallback":false},"page_view_update_url":"/page_views/6d6154c4-56df-4273-9dd7-df68d31cf70a?page_view_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpIjoiNmQ2MTU0YzQtNTZkZi00MjczLTlkZDctZGY2OGQzMWNmNzBhIiwidSI6MTE4MzQwMDAwMDAwMjg3NzcyLCJjIjoiMjAyMy0xMC0yOVQwNDowNjo1OC4yMVoifQ.cKv3Fo_UOxuGtL-EuYlIkeMBe6OORiOEi4vImru4lV4","context_asset_string":"course_238659","ping_url":"https://q.utoronto.ca/api/v1/courses/238659/ping","TIMEZONE":"America/New_York","CONTEXT_TIMEZONE":"America/New_York","LOCALES":["en-CA","en"],"BIGEASY_LOCALE":"en_CA","FULLCALENDAR_LOCALE":"en-ca","MOMENT_LOCALE":"en-ca","rce_auto_save_max_age_ms":86400000,"K5_USER":false,"USE_CLASSIC_FONT":false,"K5_HOMEROOM_COURSE":false,"K5_SUBJECT_COURSE":false,"LOCALE_TRANSLATION_FILE":"/dist/javascripts/translations/en-CA-6065eb10af.json","ACCOUNT_ID":"28","user_cache_key":"a0ppbnI1SDJUVkVlOGdJSHdtWDh2VExxOXVGTlE5TEpVRjZKempwMHZ5Zlc9\nO1twLTA/OntQXz1IVXBncmFxZTtuamFsa2hwdm9pdWxraW1tYXFld2c=\n","WIKI_RIGHTS":{"read":true},"PAGE_RIGHTS":{"read":true},"DEFAULT_EDITING_ROLES":"teachers","WIKI_PAGES_PATH":"/courses/238659/pages","WIKI_PAGE":{"title":"Lab 2: A cooperative, user-level thread package","created_at":"2021-08-12T10:16:30-04:00","url":"lab-2-a-cooperative-user-level-thread-package","editing_roles":"teachers","page_id":"862344","last_edited_by":{"id":"64820","anonymous_id":"1e0k","display_name":"Michael Stumm","avatar_image_url":"https://q.utoronto.ca/images/messages/avatar-50.png","html_url":"https://q.utoronto.ca/courses/238659/users/64820","pronouns":null},"published":true,"hide_from_students":false,"front_page":false,"html_url":"https://q.utoronto.ca/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package","todo_date":null,"publish_at":null,"updated_at":"2021-09-23T14:52:21-04:00","locked_for_user":false,"body":"\u003cp\u003e\u003cstrong\u003eQuick Links: \u0026nbsp; \u003c/strong\u003e\u0026nbsp;\u003ca class=\"inline_disabled\" href=\"https://q.utoronto.ca/courses/238659\" target=\"_blank\"\u003eHome\u003c/a\u003e \u0026nbsp;\u0026nbsp; \u0026nbsp;\u0026nbsp;\u003ca title=\"Lecture Material\" href=\"https://q.utoronto.ca/courses/238659/pages/lecture-material\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lecture-material\" data-api-returntype=\"Page\"\u003eLecture material \u003c/a\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u003ca title=\"Lab Assignments\" href=\"https://q.utoronto.ca/courses/238659/pages/lab-assignments\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-assignments\" data-api-returntype=\"Page\"\u003eLab assignments\u003c/a\u003e \u0026nbsp; \u0026nbsp; \u0026nbsp; \u003ca class=\"inline_disabled\" href=\"http://piazza.com/utoronto.ca/fall2021/ece344/home\" target=\"_blank\"\u003e\u003cspan\u003ePiazza Discussion\u003c/span\u003e\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch4\u003e\u003cstrong\u003eDue Date: October 15, 11:59pm EST\u003c/strong\u003e\u003c/h4\u003e\n\u003cp\u003e\u0026nbsp;\u003c/p\u003e\n\u003cp\u003eIn this lab, you will create a library of functions that define a user-level threads package. Using your library, a program will be able to create threads, destroy them, and run them concurrently on a single processor.\u003c/p\u003e\n\u003ch2\u003eBackground on Threads\u003c/h2\u003e\n\u003cp\u003eThreads and processes are key abstractions for enabling concurrency in operating systems. To gain a deeper understanding of how these abstractions are constructed, this project asks you to build the core of a user-level threads package. Building kernel-level threads and processes is much different, but we'll do this project at user level since installing new kernels on the lab machines is problematic.\u003c/p\u003e\n\u003cp\u003eThreads provide the illusion that different parts of your program are executing concurrently. Through the years, a model of executing multithreaded programs has emerged as a defacto standard. In this model, threads share the code, heap, and the runtime system. Each thread, however, has a separate stack and, naturally, a separate set of CPU registers. This programming model also provides synchronization primitives so that different threads can coordinate access to shared resources.\u003c/p\u003e\n\u003ch2\u003eUser-Level vs. Kernel Threads\u003c/h2\u003e\n\u003cp\u003eFor practical reasons, this project is done at user level: you will construct user threads by implementing a set of functions that your program will call directly to provide the illusion of concurrency. In contrast, modern operating systems provide kernel threads, and a user program invokes the corresponding kernel thread functions via system calls. Both types of threads use the same core techniques for providing the concurrency abstraction; you would build kernel threads in essentially the same way you build user threads in this project. Also, kernel processes are built using these techniques.\u003c/p\u003e\n\u003cp\u003eHowever, there are a few differences between kernel and user threads:\u003c/p\u003e\n\u003cdl\u003e\n\u003cdt\u003eMultiprocessing\u003c/dt\u003e\n\u003cdd\u003eWhereas user-level threads provide the illusion of concurrency, on machines with multiple processors, kernel-level threads can provide actual concurrency. With user-level threads, the kernel schedules the user process on one CPU, and the user-level threads package multiplexes the (kernel) thread associated with the process between one or more (user-level) threads. With kernel-level threads, the kernel is aware of the different (kernel) threads, and it can simultaneously schedule these threads from the same process on different processors.\u003cbr\u003e\u003cbr\u003eA key simplifying assumption for this project is that you will allow programs to multiplex some number (e.g., \u003ci\u003em\u003c/i\u003e) of user-level threads on \u003ci\u003eone\u003c/i\u003e kernel thread. This means that at most one user-level thread is running at a time and that your runtime system has complete control over the interleaving of user-level threads with each other. More sophisticated systems implement \u003ci\u003em on n\u003c/i\u003e threads packages where \u003ci\u003em\u003c/i\u003e user-level threads are multiplexed across \u003ci\u003en\u003c/i\u003e kernel threads.\u003c/dd\u003e\n\u003cdt\u003e\u003c/dt\u003e\n\u003cdt\u003eAsynchronous I/O\u003c/dt\u003e\n\u003cdd\u003eWhen a user-level thread makes a system call that blocks (e.g., reading a file from disk), the kernel scheduler moves the process to the \u003ckbd\u003eBlocked\u003c/kbd\u003e state and will not schedule it until the I/O has completed. Thus, even if there are other user-level threads within that process, they have to wait, too. Conversely, when a kernel thread blocks for a system call, the kernel scheduler is aware that other threads in the same process may be ready to run. Thus, some kernel threads may be running while others are waiting for I/O.\u003c/dd\u003e\n\u003cdt\u003e\u003c/dt\u003e\n\u003cdt\u003eTimer interrupts\u003c/dt\u003e\n\u003cdd\u003eIn the next lab, we will simulate timer interrupts that cause the scheduler to switch from one thread or process to another by using POSIX signals. In your implementation, the threads library will \"turn off interrupts\" by blocking delivery of these signals using system calls. However, there is nothing to prevent the threads, themselves, from \"turning off interrupts\" the same way. Thus, even though we will implement \"preemptive\" threads, a \"malicious\" thread could turn off interrupts and not be preempted until it calls yield, thus hogging the CPU. Note that kernel schedulers don't have this problem. Only the privileged code in the kernel can turn off the real timer interrupts.\u003c/dd\u003e\n\u003c/dl\u003e\n\u003ch2\u003eUsing Threads\u003c/h2\u003e\n\u003cp\u003eWith your threads library, a typical program will look like:\u003c/p\u003e\n\u003cpre\u003eint\nmain(int argc, char **argv)\n{\n    // Some initialization\n    // Create some threads\n    // wait for threads to finish\n    // exit\n}\n\n// \"main\" function for thread i\nthread_main_i (...)\n{\n    // do some work\n    // yield\n    // do some more work\n    // return (implicit thread exit)\n}\n\u003c/pre\u003e\n\u003cp\u003eHere \u003ckbd\u003ethread_main_i\u003c/kbd\u003e is a programmer-supplied \"main\" function that the i\u003csup\u003eth\u003c/sup\u003e thread starts executing (note that different threads may have the same \"main\" function). The thread can perform useful work by calling any other functions in the program, or voluntarily yielding to other threads.\u003c/p\u003e\n\u003cp\u003eA thread exits either explicitly or implicitly. It exits explicitly when it calls the \u003ckbd\u003ethread_exit\u003c/kbd\u003e function in the thread library. It exits implicitly when its \u003ckbd\u003ethread_main\u003c/kbd\u003e function returns. Additionally, to add more control to the program, a thread may call \u003ckbd\u003ethread_kill\u003c/kbd\u003e to force other threads to exit as well.\u003c/p\u003e\n\u003ch2 id=\"thread-context\"\u003eThread Context\u003c/h2\u003e\n\u003cp\u003e\u003ca name=\"thread-context\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eEach thread has \u003ci\u003eper-thread state\u003c/i\u003e that represents the working state of the thread -- the thread's program counter, local variables, stack, etc. A \u003ci\u003ethread context\u003c/i\u003e is a subset of this state that must be saved/restored from the processor when switching threads. (To avoid copying the entire stack, the thread context includes a pointer to the stack, not the entire stack.) Your library will store the thread context in a per-thread data structure (this structure is sometimes called the \"thread control block\").\u003c/p\u003e\n\u003ch3 id=\"context-switch\"\u003eSaving/Restoring Thread Context\u003c/h3\u003e\n\u003cp\u003eWhen a thread yields the CPU, the threads library must save the current thread's context, which contains the processor register values at the time the thread yields the CPU. The library restores the saved context later when the thread gets its turn to run on the processor. Additionally, the library creates a fresh context and a new stack when it creates a thread.\u003c/p\u003e\n\u003cp\u003eFortunately, the C runtime system allows an application to conveniently retrieve its current context and store it in a memory location, and to set its current context to a predetermined value from a memory location. Your library will make use of these two existing library calls: \u003ckbd\u003egetcontext\u003c/kbd\u003e and \u003ckbd\u003esetcontext\u003c/kbd\u003e.\u003c/p\u003e\n\u003cp\u003eStudy the \u003ca href=\"http://linux.die.net/man/2/setcontext\"\u003emanual pages\u003c/a\u003e of these two calls. Notice that \u003ckbd\u003egetcontext\u003c/kbd\u003e saves the current context into a structure of type \u003ckbd\u003estruct ucontext\u003c/kbd\u003e of type \u003ckbd\u003eucontext_t\u003c/kbd\u003e. So, if you allocate a \u003ckbd\u003estruct ucontext\u003c/kbd\u003e and pass a pointer to that memory to a call to \u003ckbd\u003egetcontext\u003c/kbd\u003e, the current registers and other context will be stored to that memory. Later, you can call \u003ckbd\u003esetcontext\u003c/kbd\u003e to copy that state from that memory to the processor, restoring the saved state.\u003c/p\u003e\n\u003cp\u003eThe \u003ckbd\u003estruct ucontext\u003c/kbd\u003e is defined in \u003ckbd\u003e/usr/include/sys/ucontext.h\u003c/kbd\u003e. Look at the fields of this struct in detail, especially the \u003ckbd\u003euc_mcontext\u003c/kbd\u003e and the \u003ckbd\u003euc_sigmask\u003c/kbd\u003e fields.\u003c/p\u003e\n\u003cp\u003eYou will use \u003ckbd\u003egetcontext\u003c/kbd\u003e and \u003ckbd\u003esetcontext\u003c/kbd\u003e in two ways. First, to suspend a currently running thread (to run another one), you will use \u003ckbd\u003egetcontext\u003c/kbd\u003e to save its state and later use \u003ckbd\u003esetcontext\u003c/kbd\u003e to restore its state. Second, to create a new thread, you will use \u003ckbd\u003egetcontext\u003c/kbd\u003e to create a valid context, but you will leave the current thread running; you (the current thread, actually) will then change a few registers in this valid context to initialize it as a new thread, and put this new thread into the ready queue; finally, at some point, the new thread will be chosen by the scheduler, and it will run when \u003ci\u003esetcontext\u003c/i\u003e is called on this new thread's context.\u003c/p\u003e\n\u003ch3\u003eChanging Thread Context\u003c/h3\u003e\n\u003cp\u003eAs noted above, when creating a thread, you can't just make a copy of the current thread's context (using \u003ckbd\u003egetcontext\u003c/kbd\u003e). You need to make a copy and then change four things:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eYou need to change the program counter to point to the first function that the thread should run.\u003c/li\u003e\n\u003cli\u003eYou need to allocate a new stack.\u003c/li\u003e\n\u003cli\u003eYou need to change the stack pointer to point to the top of the new stack.\u003c/li\u003e\n\u003cli\u003eYou need to setup the parameters to the first function.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn the real world, you would take advantage of an existing library function, \u003ckbd\u003emakecontext\u003c/kbd\u003e, to make the first, third and fourth changes. The advantage of using this function is that it abstracts away the details of how a context is saved in memory, which simplifies things and helps portability. The disadvantage is that it abstracts away the details of how a context is saved in memory, which might leave you vague on exactly what's going on.\u003c/p\u003e\n\u003cp\u003eIn the spirit of \"there is no magic\", for this lab you should \u003cem\u003enot\u003c/em\u003e use \u003ckbd\u003emakecontext\u003c/kbd\u003e or \u003ckbd\u003eswapcontext\u003c/kbd\u003e. Instead, you must manipulate the fields in the saved \u003ckbd\u003eucontext_t\u003c/kbd\u003e directly.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eYou will change the program counter to point to a \u003ci\u003estub function\u003c/i\u003e, described below, that should be the first function the thread runs.\u003c/li\u003e\n\u003cli\u003eYou will use \u003ckbd\u003emalloc\u003c/kbd\u003e to allocate a new per-thread stack.\u003c/li\u003e\n\u003cli\u003eYou will change the stack pointer to point to the top of the new stack. (Warning: in x86-64, stacks grow down!)\u003c/li\u003e\n\u003cli\u003eYou will initialize the argument registers, \u003ca title=\"Lab 2: A cooperative, user-level thread package\" href=\"https://q.utoronto.ca/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package#calling-convention\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package%23calling-convention\" data-api-returntype=\"Page\"\u003edescribed further below\u003c/a\u003e, with the arguments that are to be passed to the stub function.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhat is the stub function? How do the arguments work? Read on.\u003c/p\u003e\n\u003ch3 id=\"stub\"\u003eStub Function\u003c/h3\u003e\n\u003cp\u003eWhen you create a new thread, you want it to run the \u003ckbd\u003ethread_main\u003c/kbd\u003e function that defines the work you want the thread to do. A thread exits implicitly when it returns from its \u003ckbd\u003ethread_main\u003c/kbd\u003efunction, much like the main program thread is destroyed by the OS when it returns from its \u003ckbd\u003emain\u003c/kbd\u003e function in C, even when the \u003ckbd\u003emain\u003c/kbd\u003e function doesn't invoke the \u003ckbd\u003eexit\u003c/kbd\u003e system call. To implement a similar implicit thread exit, rather than having your thread begin by running the \u003ckbd\u003ethread_main\u003c/kbd\u003e function directly, you should start the thread initially in a \"stub\" function that calls the \u003ckbd\u003ethread_main\u003c/kbd\u003e function of the thread (much like main is actually called from the \u003ckbd\u003ecrt0\u003c/kbd\u003e stub function in UNIX). In other words, \u003ckbd\u003ethread_create\u003c/kbd\u003e should setup a thread so that it starts running the \u003ckbd\u003ethread_stub\u003c/kbd\u003e function shown below. Then, when the thread runs for the first time, it will execute \u003ckbd\u003ethread_stub\u003c/kbd\u003e, which will call \u003ckbd\u003ethread_main\u003c/kbd\u003e. Then, your \u003ckbd\u003ethread_main\u003c/kbd\u003e function can return to the stub function, should it return.\u003c/p\u003e\n\u003cpre\u003e/* thread starts by calling thread_stub. The arguments to thread_stub are the\n * thread_main() function, and one argument to the thread_main() function. */\nvoid\nthread_stub(void (*thread_main)(void *), void *arg)\n{\n\tTid ret;\n\n\tthread_main(arg); // call thread_main() function with arg\n\tthread_exit();\n}\n\u003c/pre\u003e\n\u003cp\u003eIn the above code, the argument \u003ckbd\u003ethread_main\u003c/kbd\u003e is a pointer to the \u003ckbd\u003ethread_main\u003c/kbd\u003e function that describes the real work the thread should do. Notice that in C, a function's name refers to the address of its code in memory. The second argument to \u003ckbd\u003ethread_stub\u003c/kbd\u003e (\u003ckbd\u003earg\u003c/kbd\u003e) is the argument to pass to the \u003ckbd\u003ethread_main\u003c/kbd\u003e function. We'll have the \u003ckbd\u003ethread_main\u003c/kbd\u003e function take an argument that is a pointer to an arbitrary type so that you can pass it whatever you want. The \u003ckbd\u003ethread_exit\u003c/kbd\u003e function is defined below.\u003c/p\u003e\n\u003ch3 id=\"calling-convention\"\u003eContexts and Calling Conventions\u003c/h3\u003e\n\u003cp\u003e\u003ca name=\"calling-convention\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe context structure contains many data fields, but you only need to deal with four of them when creating new threads: the stack pointer, the program counter, and two argument registers. Other than that, you don't need to worry about the fields within the context variable, as long as you do not tamper with them. Also, it is a good idea to use variables that have been initialized through a \u003ckbd\u003egetcontext\u003c/kbd\u003e call in order to not have bizarre behavior.\u003c/p\u003e\n\u003cp\u003eUnder the \u003ca href=\"http://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI\"\u003ePosix C calling conventions in x86-64\u003c/a\u003e, here's what things look like while any given function is executing:\u003c/p\u003e\n\u003cp\u003e\u003cimg id=\"11951093\" src=\"https://q.utoronto.ca/courses/238659/files/15364713/preview\" alt=\"stack.png\" width=\"600\" height=\"462\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/files/15364713\" data-api-returntype=\"File\"\u003e \u0026nbsp;\u003c/p\u003e\n\u003cp\u003eNotice that while a procedure executes, it can allocate stack space by moving the stack pointer down (stack grows downwards). However, it can find local variables, parameters, return addresses, and the old frame pointer (old \u003ckbd\u003e%rbp\u003c/kbd\u003e) by indexing relative to the frame pointer (\u003ckbd\u003e%rbp\u003c/kbd\u003e) register because its value does not change during the duration of a function call.\u003c/p\u003e\n\u003cp\u003eWhen a function needs to make a function call, it copies the arguments of the \"callee\" function (the function to be called) to the registers shown on the right in the x86-64 architure. For example, the \u003ckbd\u003e%rdi\u003c/kbd\u003e register will contain the first argument, the \u003ckbd\u003e%rsi\u003c/kbd\u003e register will contain the second argument, etc. Then the caller saves the current instruction pointer (\u003ckbd\u003e%rip\u003c/kbd\u003e) into the stack (shown as \"return address\" in the figure), and changes the instruction pointer to the callee function. At this point the stack pointer (\u003ckbd\u003e%rsp\u003c/kbd\u003e) points to the return address (shown in the figure). Note that the stack pointer points to the last pushed value in the stack.\u003c/p\u003e\n\u003cp\u003eThe callee function then starts executing. It first pushes the the frame pointer value of the caller function (shown as old \u003ckbd\u003e%rbp\u003c/kbd\u003e) into the stack, and then sets the frame pointer (\u003ckbd\u003e%rbp\u003c/kbd\u003e) to the current stack pointer (\u003ckbd\u003e%rbp = %rsp\u003c/kbd\u003e), so that it points to the old frame pointer value. Then the callee function decrements the stack pointer (shown as \u003ckbd\u003e%rsp\u003c/kbd\u003e), and uses the space between the frame pointer and the stack pointer for its local variables, for saving or spilling other registers, etc. As an example, these three steps are performed by the first three instructions (\u003ckbd\u003epush\u003c/kbd\u003e, \u003ckbd\u003emov\u003c/kbd\u003e and \u003ckbd\u003esub\u003c/kbd\u003e) in the disassembled main function shown below. The callee locates its variables, parameters, and the return address, by using addresses relative to the fixed frame pointer (\u003ckbd\u003e%rbp\u003c/kbd\u003e).\u003c/p\u003e\n\u003cp\u003eTo return to the caller, a procedure simply copies the frame pointer (\u003ckbd\u003e%rbp\u003c/kbd\u003e) to the stack pointer (\u003ckbd\u003e%rsp = %rbp\u003c/kbd\u003e), effectively releasing the current frame. Then it pops the top stack item into \u003ckbd\u003e%rbp\u003c/kbd\u003eto restore the \u003ckbd\u003e%rbp\u003c/kbd\u003e of the caller function, and then uses the \u003ckbd\u003eret\u003c/kbd\u003e instruction to pop the old instruction pointer off the stack into the instruction register (\u003ckbd\u003e%rip\u003c/kbd\u003e), returning control to the caller function. These steps are performed by the last two instructions (\u003ckbd\u003eleaveq\u003c/kbd\u003e, \u003ckbd\u003eretq\u003c/kbd\u003e) in the disassembled\u0026nbsp;main function below.\u003c/p\u003e\n\u003cp\u003eThis is a gdb listing for the \u003ckbd\u003etest_basic\u003c/kbd\u003e program that we will provide you for this lab. Run gdb on it (or on any program that you have compiled on the lab machines), as shown below, to see the instructions at the start and the end of a function (e.g., \u003ckbd\u003emain\u003c/kbd\u003e function). Make sure that you understand what these instructions are doing, and are able to answer the questions in the listing below.\u003c/p\u003e\n\u003cpre id=\"disassemble\"\u003e$ cd threads\n$ gdb test_basic\n...\n(gdb) b main\nBreakpoint 1 at 0x4009ab: file test_basic.c, line 7.\n(gdb) r\n...\n\nBreakpoint 1, main (argc=1, argv=0x7fffffffe868) at test_basic.c:7\n7               thread_init(0);\n(gdb) disassemble main\nDump of assembler code for function main:\n   0x000000000040099c \u0026lt;+0\u0026gt;:     \u003cstrong\u003epush   %rbp\u003c/strong\u003e\n   0x000000000040099d \u0026lt;+1\u0026gt;:     \u003cstrong\u003emov    %rsp,%rbp\u003c/strong\u003e\n   0x00000000004009a0 \u0026lt;+4\u0026gt;:     \u003cstrong\u003esub    $0x10,%rsp\u003c/strong\u003e\n   0x00000000004009a4 \u0026lt;+8\u0026gt;:     mov    %edi,-0x4(%rbp)  \u003cstrong\u003e// what is happening here?\u003c/strong\u003e\n   0x00000000004009a7 \u0026lt;+11\u0026gt;:    mov    %rsi,-0x10(%rbp) \u003cstrong\u003e// what is happening here?\u003c/strong\u003e\n=\u0026gt; 0x00000000004009ab \u0026lt;+15\u0026gt;:    mov    $0x0,%edi\n   0x00000000004009b0 \u0026lt;+20\u0026gt;:    callq  0x401edc \u0026lt;thread_init\u0026gt;\n   0x00000000004009b5 \u0026lt;+25\u0026gt;:    mov    $0x0,%eax\n   0x00000000004009ba \u0026lt;+30\u0026gt;:    callq  0x4009dc \u0026lt;test_basic\u0026gt;\n   0x00000000004009bf \u0026lt;+35\u0026gt;:    mov    $0x0,%eax\n   0x00000000004009c4 \u0026lt;+40\u0026gt;:    \u003cstrong\u003eleaveq\u003c/strong\u003e\n   0x00000000004009c5 \u0026lt;+41\u0026gt;:    \u003cstrong\u003eretq\u003c/strong\u003e\nEnd of assembler dump.\n\u003c/pre\u003e\n\u003cp\u003eOne complication with the \u003ca href=\"http://en.wikipedia.org/wiki/X86_calling_conventions#List_of_x86_calling_conventions\"\u003ePosix C x86-64\u003c/a\u003e calling convention is that it requires the frame pointer \u003ckbd\u003e%rbp\u003c/kbd\u003e to aligned to 16 bytes. This \u003ca href=\"http://en.wikipedia.org/wiki/Data_structure_alignment\"\u003ebyte alignment\u003c/a\u003e means that the value of \u003ckbd\u003e%rbp\u003c/kbd\u003e, or the stack location (stack address) to which \u003ckbd\u003e%rbp\u003c/kbd\u003e points to, must be a multiple of 16. Otherwise, system libraries \u003ca href=\"http://web.cecs.pdx.edu/~apt/cs322/x86-64.pdf\"\u003emay crash\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWhen you are creating a new thread that will execute the \u003ckbd\u003ethread_stub\u003c/kbd\u003e function, you will need to setup the stack so that this calling convention is followed. In particular, you will need to think about the byte alignment for the stack pointer and the frame pointer when control is transferred to \u003ckbd\u003ethread_stub\u003c/kbd\u003e.\u003c/p\u003e\n\u003ch2 id=\"setup\"\u003eSetup\u003c/h2\u003e\n\u003cp\u003eMake sure to go over the \u003ca class=\"inline_disabled\" title=\"Lab 1: Review of C, Data Structures, Using System Calls\" href=\"https://q.utoronto.ca/courses/238659/pages/lab-1-review-of-c-data-structures-using-system-calls#setup\" target=\"_blank\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-1-review-of-c-data-structures-using-system-calls%23setup\" data-api-returntype=\"Page\"\u003esetup instructions\u003c/a\u003e for Lab 1, if you have not done so previously.\u003c/p\u003e\n\u003cp\u003eAdd the source files for this lab, available in \u003ckbd\u003ethreads.tar\u003c/kbd\u003e, to your repository, and run \u003ckbd\u003emake\u003c/kbd\u003e in the newly created \u003ckbd\u003ethreads\u003c/kbd\u003e directory.\u003c/p\u003e\n\u003cpre\u003ecd ~/ece344\ntar -xf /cad2/ece344f/src/threads.tar\ngit status # should say that \"threads/\" directory is untracked\ngit add threads\ngit commit -m \"Initial code for Lab 2\"\ngit tag Lab2-start\ncd threads\nmake\n\u003c/pre\u003e\n\u003cp\u003eStart by implementing \u003ckbd\u003eshow_ucontext.c\u003c/kbd\u003e. Replace all instances of \"-1\" in the various \u003ckbd\u003eprintf\u003c/kbd\u003e function calls with the appropriate code (also, make sure to not modify any code at the beginning of main, as suggested by the comment there). Make sure that you are able to answer all the questions mentioned in the source file, which will help you understand the stack layout and how a thread's context is saved and restored. It will also clarify the concepts about the thread context, \u003ca href=\"https://q.utoronto.ca/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package#thread-context\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package%23thread-context\" data-api-returntype=\"Page\"\u003eintroduced above\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe implementation will also give you a brief exposure to signals, an OS concept similar to hardware interrupts. The code in \u003ckbd\u003eshow_ucontext.c\u003c/kbd\u003e will show you how to disable or enable signals, and how these actions affect the saved thread context.\u003c/p\u003e\n\u003cp\u003eMake sure to finish implementing \u003ckbd\u003eshow_ucontext.c\u003c/kbd\u003e before moving to the implementation of the threads library. You can use the \u003ca title=\"Testing your lab code\" href=\"https://q.utoronto.ca/courses/238659/pages/testing-your-lab-code\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/testing-your-lab-code\" data-api-returntype=\"Page\"\u003etester\u003c/a\u003e to test the output of your modified \u003ckbd\u003eshow_ucontext.c\u003c/kbd\u003e.\u003c/p\u003e\n\u003ch2\u003eCooperative Threads API\u003c/h2\u003e\n\u003cp\u003eIn this project, you will build a user level threads package. A key simplifying assumption in this lab is that the threads are \u003ci\u003ecooperative\u003c/i\u003e, i.e., each thread runs until it explicitly releases the CPU to another thread by yielding the thread or by exiting. In contrast \u003ci\u003epreemptive\u003c/i\u003e threading systems allow a scheduler to interrupt a running thread at any time and switch the CPU to running a different thread.\u003c/p\u003e\n\u003cp\u003eThe thread package provides several functions calls to allow application programs to perform thread management. In addition, there are a few conventions that application programs must adhere to in order to ensure proper and safe operation. A list of the functions that constitute the User-level threads API can be found in the \u003ckbd\u003ethread.h\u003c/kbd\u003e file. The functions that you will be implementing for this lab are summarized here:\u003c/p\u003e\n\u003cdl\u003e\n\u003cdt\u003e\u003cstrong\u003evoid thread_init(void):\u003c/strong\u003e\u003c/dt\u003e\n\u003cdd\u003eYou can use this function to perform any initialization that is needed by your threading system. Here, you should also \"custom\" create the first user thread in the system. To do so, you should setup the (kernel) thread that is running when your program begins (before any calls to \u003ckbd\u003ethread_create\u003c/kbd\u003e) as the first user thread in the system (with \u003ckbd\u003etid = 0\u003c/kbd\u003e). You will not need to allocate a stack for this thread, because it will run on the (user) stack allocated for this kernel thread by the OS.\u003c/dd\u003e\n\u003cdt\u003e\u003cstrong\u003eTid thread_id():\u003c/strong\u003e\u003c/dt\u003e\n\u003cdd\u003eThis function returns the thread identifier of the currently running thread. The return value should lie between 0 and THREAD_MAX_THREADS. See \u003ca href=\"https://q.utoronto.ca/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package#requirements\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package%23requirements\" data-api-returntype=\"Page\"\u003esolution requirements\u003c/a\u003e below.\u003c/dd\u003e\n\u003cdt\u003e\u003cstrong\u003eTid thread_yield(Tid tid):\u003c/strong\u003e\u003c/dt\u003e\n\u003cdd\u003eThis function suspends the caller and activates the thread given by the identifier \u003ckbd\u003etid\u003c/kbd\u003e. The caller is put on the ready queue and can be run later in a similar fashion. A reasonable policy is to add the caller to the tail of the ready queue to ensure fairness (so all other threads are run before this thread is scheduled again - see the \u003ckbd\u003eTHREAD_ANY\u003c/kbd\u003e argument below). The value of \u003ckbd\u003etid\u003c/kbd\u003emay take the identifier of any available thread. It also can take any of the following constants:\n\u003cul\u003e\n\u003cli\u003e\u003ckbd\u003eTHREAD_ANY:\u003c/kbd\u003e tells the thread system to run any thread in the ready queue. A reasonable policy is to run the thread at the head of the ready queue, which ensures fairness. This policy is called FIFO (first-in, first-out), since the thread that first entered the ready queue (among the threads that are currently in the ready queue) is scheduled first. With preemptive scheduling, as introduced in Lab 3, your FIFO scheduler will ensure round-robin scheduling because all threads in the run queue will be scheduled for (roughly) an equal amount of time (a time slot) in a round-robin fashion.\u003c/li\u003e\n\u003cli\u003e\u003ckbd\u003eTHREAD_SELF:\u003c/kbd\u003e tells the thread system to continue the execution of the caller. This function could be implemented as a no-op, but it may be useful to explicitly switch to the current thread for debugging purposes.\u003c/li\u003e\n\u003c/ul\u003e\nThe \u003ckbd\u003ethread_yield\u003c/kbd\u003e function returns the identifier of the thread that took control as a result of the function call. Note that the caller does not get to see the result until it gets its turn to run (later). The function may also fail and the caller resumes immediately. To indicate the reason for failure, the call returns one of these constants:\n\u003cul\u003e\n\u003cli\u003e\u003ckbd\u003eTHREAD_INVALID:\u003c/kbd\u003e alerts the caller that the identifier \u003ckbd\u003etid\u003c/kbd\u003e does not correspond to a valid thread.\u003c/li\u003e\n\u003cli\u003e\u003ckbd\u003eTHREAD_NONE:\u003c/kbd\u003e alerts the caller that there are no more threads, other than the caller, that are available to run, in response to a call with \u003ckbd\u003etid\u003c/kbd\u003e set to \u003ckbd\u003eTHREAD_ANY\u003c/kbd\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/dd\u003e\n\u003cdt\u003e\u003cstrong\u003eTid thread_create(void (*fn)(void *), void *arg):\u003c/strong\u003e\u003c/dt\u003e\n\u003cdd\u003eThis function creates a thread whose starting point is the function \u003ckbd\u003efn\u003c/kbd\u003e. The second argument, \u003ckbd\u003earg\u003c/kbd\u003e, is a pointer that will be passed to the function \u003ckbd\u003efn\u003c/kbd\u003e when the thread starts executing. The created thread is put on a ready queue but does not start execution yet. The caller of the function continues to execute after the function returns. Upon success, the function returns a thread identifier of type \u003ckbd\u003eTid\u003c/kbd\u003e. If the function fails, it returns a value that indicates the reason of failure as follows:\n\u003cul\u003e\n\u003cli\u003e\u003ckbd\u003eTHREAD_NOMORE:\u003c/kbd\u003e alerts the caller that the thread package cannot create more threads. See \u003ca href=\"https://q.utoronto.ca/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package#requirements\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package%23requirements\" data-api-returntype=\"Page\"\u003esolution requirements\u003c/a\u003e below.\u003c/li\u003e\n\u003cli\u003e\u003ckbd\u003eTHREAD_NOMEMORY:\u003c/kbd\u003e alerts the caller that the thread package could not allocate memory to create a stack of the desired size. See \u003ca href=\"https://q.utoronto.ca/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package#requirements\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package%23requirements\" data-api-returntype=\"Page\"\u003esolution requirements\u003c/a\u003e below.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/dd\u003e\n\u003cdt\u003e\u003cstrong\u003evoid thread_exit():\u003c/strong\u003e\u003c/dt\u003e\n\u003cdd\u003eThis function ensures that the current thread does not run after this call, i.e., this function should never return. If there are other threads in the system, one of them should be run. If there are no other threads (this is the last thread invoking \u003ckbd\u003ethread_exit\u003c/kbd\u003e), then the program should exit. A thread that is created later should be able to reuse this thread's identifier, but only after this thread has been destroyed.\u003c/dd\u003e\n\u003cdt\u003e\u003cstrong\u003eTid thread_kill(Tid tid):\u003c/strong\u003e\u003c/dt\u003e\n\u003cdd\u003eThis function kills another thread whose identifier is \u003ckbd\u003etid\u003c/kbd\u003e. The \u003ckbd\u003etid\u003c/kbd\u003e can be the identifier of any available thread. The killed thread should not run any further and the calling thread continues to execute. Upon success, this function returns the identifier of the thread that was killed. Upon failure, it returns the following:\n\u003cul\u003e\n\u003cli\u003e\u003ckbd\u003eTHREAD_INVALID:\u003c/kbd\u003e alerts the caller that the identifier \u003ckbd\u003etid\u003c/kbd\u003e does not correspond to a valid thread, or is the current thread.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/dd\u003e\n\u003c/dl\u003e\n\u003ch2 id=\"requirements\"\u003eSolution Requirements\u003c/h2\u003e\n\u003cp\u003e\u003ca name=\"requirements\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe first thread in the system (before the first call to \u003ckbd\u003ethread_create\u003c/kbd\u003e) should have a thread identifier of \u003ckbd\u003e0\u003c/kbd\u003e. Your threads system should support the creation of a maximum of \u003ckbd\u003eTHREAD_MAX_THREADS\u003c/kbd\u003e \u003cstrong\u003econcurrent\u003c/strong\u003e threads by a program (including the initial main thread). Thus, the maximum value of the thread identifier should thus be \u003ckbd\u003eTHREAD_MAX_THREADS - 1\u003c/kbd\u003e (since thread identifiers start from 0). Note that when a thread exits, its thread identifier can be reused by another thread created later.\u003c/p\u003e\n\u003cp\u003eYour library must maintain a \"thread control block\" (a thread structure) for each thread that is running in the system. This is similar to the process control block that an operating system implements to support process management. In addition, your library must maintain a queue of the threads that are ready to run, so that when the current thread yields, the next thread in the ready queue can be run. Your library allows running a fixed number of threads (\u003ckbd\u003eTHREAD_MAX_THREADS\u003c/kbd\u003e threads), so if it is helpful, you could allocate these structures statically (e.g., as a global array).\u003c/p\u003e\n\u003cp\u003eEach thread should have a stack of at least \u003ckbd\u003eTHREAD_MIN_STACK\u003c/kbd\u003e size. Your implementation \u003cstrong\u003emust not\u003c/strong\u003e statically allocate all stacks at initialization time (e.g., using a global data structure). Instead, you must dynamically allocate a stack (e.g., using \u003ckbd\u003emalloc()\u003c/kbd\u003e) whenever a new thread is created (and delete one each time a thread is destroyed.)\u003c/p\u003e\n\u003cp\u003eAs noted above, your library must use \u003ckbd\u003egetcontext\u003c/kbd\u003e and \u003ckbd\u003esetcontext\u003c/kbd\u003e to save and restore thread context state, but it \u003cstrong\u003emay not use\u003c/strong\u003e \u003ckbd\u003emakecontext\u003c/kbd\u003e, or \u003ckbd\u003eswapcontext\u003c/kbd\u003e or any other existing code to manipulate a thread's context; you need to write the code to do that yourself.\u003c/p\u003e\n\u003cp\u003eYour code \u003cstrong\u003emust not\u003c/strong\u003e make calls to any existing threads libraries (e.g., Linux pthreads), or borrow code from these libraries for this lab.\u003c/p\u003e\n\u003cp\u003eYou may borrow any code for data structures, e.g., hash tables, that you have implemented in the previous ECE344 labs. Do \u003cstrong\u003enot\u003c/strong\u003e use any code from other students, or from code available on the Internet. When in doubt, please ask us.\u003c/p\u003e\n\u003ch2 id=\"advice\"\u003eHints and Advice\u003c/h2\u003e\n\u003cp\u003eThis project does not require writing a large number of lines of code. It does require you to think carefully about the code you write. Before you dive into writing code, it will pay to spend time planning and understanding the code you are going to write. If you think the problem through from beginning to end, this project will not be too hard. If you try to hack your way out of trouble, you will spend many frustrating nights in the lab.\u003c/p\u003e\n\u003cp\u003eAs a start, here are some questions you should answer before you write code.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWhat fields will you need in your thread structure? Perhaps the most important is the thread state (e.g., running, etc.). Think about all the states that you will need to support.\u003c/li\u003e\n\u003cli\u003e\u003ckbd\u003egetcontext\u003c/kbd\u003e \"returns\" twice. When it is called directly, it initializes the context structure that is passed as an argument, and then execution continues after the \u003ckbd\u003egetcontext()\u003c/kbd\u003e call. Then, when \u003ckbd\u003esetcontext()\u003c/kbd\u003e is called later, execution returns to the instruction following the \u003ckbd\u003egetcontext()\u003c/kbd\u003e call, which appears to be a second \"return\", since the code continues running from the instruction following \u003ckbd\u003egetcontext()\u003c/kbd\u003e. For this lab, you will use this behavior, once when you create a context, and again when you switch to that context. What action will you take in each case? How will you tell which case you are in?\u003c/li\u003e\n\u003cli\u003eMost threads are created with \u003ckbd\u003ethread_create\u003c/kbd\u003e, but the initial thread is there before your library is invoked. Nonetheless, the original thread must be able to \u003ckbd\u003ethread_yield\u003c/kbd\u003e to let other threads run, and other threads must be able to call \u003ckbd\u003ethread_yield\u003c/kbd\u003e and let the original thread run. How is this going to work?\u003c/li\u003e\n\u003cli\u003eA hard bug to find would be an overflow or underflow of the stack you allocate. How might such a bug manifest itself? What defensive programming strategies can you use to detect stack overflow in a more controlled manner as the system runs?\u003c/li\u003e\n\u003cli\u003eNote that when the initial thread in a C process returns, it calls the \u003ckbd\u003eexit\u003c/kbd\u003e system call, which causes the OS to destroy the process, even if you have other user level threads in the process that want to run. How will you ensure that the program exits only when the last thread in your system exits?\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBe careful.\u003c/strong\u003e It is dangerous to use memory once it has been freed. In particular, you should not free the stack of the currently running thread in \u003ckbd\u003ethread_exit\u003c/kbd\u003e while it is still running. So how will you make sure that the thread stack is eventually deallocated? How will you make sure that another thread that is created in between does not start using this stack (and then you inadvertently deallocate it)? You should convince yourself that your program would work even if you used a debugging malloc library that overwrites a block with dummy data when that block is free()'d.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBe careful.\u003c/strong\u003e If you destroy a thread that is holding or waiting on a resource such as a lock (we will be implementing locks in the next lab), problems can occur. For example, deadlock may occur because the thread holding the lock may not have a chance to release the lock. Similarly, if the thread waiting on a lock is destroyed, then the thread releasing the lock may wake up some other thread incorrectly (e.g., due to reusing thread id). For this reason, it is important to ensure that when \u003ckbd\u003ethread_kill\u003c/kbd\u003e is invoked on a thread, the target thread should \u003cstrong\u003enot\u003c/strong\u003e exit immediately. Instead, the target thread should exit when it runs the next time. How will you implement this functionality? In practice, operating systems provide a signal handler mechanism that allows threads to clean up their resources (e.g., locks) before they exit.\u003c/li\u003e\n\u003cli\u003eWhat are the similarities and differences between \u003ckbd\u003ethread_yield\u003c/kbd\u003e and \u003ckbd\u003ethread_exit\u003c/kbd\u003e? Think carefully. It will be useful to encapsulate all that is similar in a common function, which will help reduce bugs, and possibly make your code simpler.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWe \u003cstrong\u003estrongly recommend\u003c/strong\u003e that your first milestone might be for \u003ckbd\u003ethread_yield(THREAD_SELF)\u003c/kbd\u003e to work for the initial thread (where your implementation stores and then restores the caller's state). Get this working before you try to implement \u003ckbd\u003ethread_create\u003c/kbd\u003e or \u003ckbd\u003ethread_exit\u003c/kbd\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eUse a debugger\u003c/strong\u003e. As an exercise, put a breakpoint at the instruction after you copy the current thread's state using \u003ckbd\u003egetcontext\u003c/kbd\u003e. You can print the current values of the registers (in gdb, type \u003ckbd\u003einfo registers\u003c/kbd\u003e).\u003c/p\u003e\n\u003cpre\u003e(gdb) info registers\nrax            0x0      0\nrbx            0x0      0\nrcx            0x7ffff7a926b1   140737348445873\nrdx            0x605910 6314256\nrsi            0x0      0\nrdi            0x0      0\nrbp            0x7fffffffdec0   0x7fffffffdec0\nrsp            0x7fffffffdea0   0x7fffffffdea0\nr8             0x7ffff7dd8e60   140737351880288\nr9             0x7ffff7a55c60   140737348197472\nr10            0x8      8\nr11            0x246    582\nr12            0x400970 4196720\nr13            0x7fffffffe850   140737488349264\nr14            0x0      0\nr15            0x0      0\nrip            0x4024de 0x4024de\neflags         0x246    [ PF ZF IF ]\ncs             0x33     51\nss             0x2b     43\nds             0x0      0\nes             0x0      0\nfs             0x0      0\ngs             0x0      0\n\u003c/pre\u003e\n\u003cp\u003eYou can print the values stored in your thread struct and the thread context. For example, say \u003ckbd\u003ecurrent\u003c/kbd\u003e is a pointer to the thread structure associated with the currently running thread, and \u003ckbd\u003econtext\u003c/kbd\u003e is a field in this structure that stores the thread context. Then, in gdb, you can use \u003ckbd\u003ep/x current-\u0026gt;context\u003c/kbd\u003e to print the context stored by a call to \u003ckbd\u003egetcontext\u003c/kbd\u003e.\u003c/p\u003e\n\u003cp\u003eYou may find this particularly useful in making sure that the state you \"restore\" when you run a newly-created thread for the first time makes sense.\u003c/p\u003e\n\u003ch2\u003eFrequently Asked Questions\u003c/h2\u003e\n\u003cp\u003eWe have provided answers to various \u003ca title=\"FAQ: Lab 2\" href=\"https://q.utoronto.ca/courses/238659/pages/faq-lab-2\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/faq-lab-2\" data-api-returntype=\"Page\"\u003efrequently asked questions (FAQ)\u003c/a\u003e about the lab. Make sure to go over them. We have provided answers to many questions that students have asked in previous years, so you will save time by going over these answers as you start working on the lab.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eStart early, we mean it!\u003c/em\u003e\u003c/p\u003e\n\u003ch2\u003eTesting Your Code\u003c/h2\u003e\n\u003cp\u003eWe have provided the program \u003ckbd\u003etest_basic.c\u003c/kbd\u003e for testing this lab. Use it to test your code.\u003c/p\u003e\n\u003cp\u003eYou can also test your code by using our auto-tester program at any time by following the \u003ca title=\"Testing your lab code\" href=\"https://q.utoronto.ca/courses/238659/pages/testing-your-lab-code\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/testing-your-lab-code\" data-api-returntype=\"Page\"\u003etesting instructions\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"using-git\"\u003eUsing Git\u003c/h2\u003e\n\u003cp\u003eYou should only modify the following files in this lab.\u003c/p\u003e\n\u003cpre\u003eshow_ucontext.c\nthread.c\n\u003c/pre\u003e\n\u003cp\u003eYou can find the files you have modified by running the \u003ckbd\u003egit status\u003c/kbd\u003e command.\u003c/p\u003e\n\u003cp\u003eYou can commit your modified files to your local repository as follows:\u003c/p\u003e\n\u003cpre\u003egit add show_ucontext.c thread.c\ngit commit -m \"Committing changes for Lab 2\"\n\u003c/pre\u003e\n\u003cp\u003eWe suggest committing your changes frequently by rerunning the commands above (with different meaningful messages to the commit command), so that you can go back to see the changes you have made over time, if needed.\u003c/p\u003e\n\u003cp\u003eOnce you have tested your code, \u003cstrong\u003eand committed it\u003c/strong\u003e (check that by running \u003ckbd\u003egit status\u003c/kbd\u003e), you can tag the assignment as done.\u003c/p\u003e\n\u003cpre\u003egit tag Lab2-end\n\u003c/pre\u003e\n\u003cp\u003eThis tag names the last commit, and you can see that using the \u003ckbd\u003egit log\u003c/kbd\u003e or the \u003ckbd\u003egit show\u003c/kbd\u003e commands.\u003c/p\u003e\n\u003cp\u003eIf you want to see all the changes you have made in this lab, you can run the following \u003ckbd\u003egit diff\u003c/kbd\u003e command.\u003c/p\u003e\n\u003cpre\u003egit diff Lab2-start Lab2-end\n\u003c/pre\u003e\n\u003cp\u003eMore information for using the various git commands is available in the \u003ca title=\"Lab 1: Review of C, Data Structures, Using System Calls\" href=\"https://q.utoronto.ca/courses/238659/pages/lab-1-review-of-c-data-structures-using-system-calls#git\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/lab-1-review-of-c-data-structures-using-system-calls%23git\" data-api-returntype=\"Page\"\u003eLab 1 instructions\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eCode Submission\u003c/h2\u003e\n\u003cp\u003eMake sure to add the \u003ckbd\u003eLab2-end\u003c/kbd\u003e tag to your local repository as described above. Then run the following command to update your remote repository:\u003c/p\u003e\n\u003cpre\u003egit push\ngit push --tags\n\u003c/pre\u003e\n\u003cp\u003eFor more details regarding code submission, please follow the \u003ca title=\"Submitting Lab Code\" href=\"https://q.utoronto.ca/courses/238659/pages/submitting-lab-code\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/submitting-lab-code\" data-api-returntype=\"Page\"\u003elab submission instructions\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003ePlease also make sure to test whether your submission succeeded by simulating our \u003ca title=\"Testing your lab code\" href=\"https://q.utoronto.ca/courses/238659/pages/testing-your-lab-code#marker\" data-api-endpoint=\"https://q.utoronto.ca/api/v1/courses/238659/pages/testing-your-lab-code%23marker\" data-api-returntype=\"Page\"\u003eautomated marker\u003c/a\u003e.\u003c/p\u003e"},"WIKI_PAGE_REVISION":"5","WIKI_PAGE_SHOW_PATH":"/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package","WIKI_PAGE_EDIT_PATH":"/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package/edit","WIKI_PAGE_HISTORY_PATH":"/courses/238659/pages/lab-2-a-cooperative-user-level-thread-package/revisions","COURSE_ID":"238659","MODULES_PATH":"/courses/238659/modules","wiki_page_menu_tools":[],"wiki_index_menu_tools":[],"DISPLAY_SHOW_ALL_LINK":false,"CAN_SET_TODO_DATE":false,"TITLE_AVAILABILITY_PATH":"/api/v1/courses/238659/page_title_availability","badge_counts":{"submissions":0},"notices":[],"active_context_tab":"pages"};
    BRANDABLE_CSS_HANDLEBARS_INDEX = [["new_styles_normal_contrast","new_styles_high_contrast","new_styles_normal_contrast_rtl","new_styles_high_contrast_rtl"],{"10":["8300658022",0,"250b5824c2",2],"15":["fc26aa5fd4",0,"f904416063",2],"19":["df5777ed9c"],"61":["f3934dab06","f405852bb2","ee5810890b","3fd9943b9a"],"67":["8b57f54e71",0,"43833dde85",2],"71":["35b89b103a","4304be7d41","58dbfc2651","2932678b1c"],"06":["cb9f63cba6",0,"2be010fc14",2],"f0":["7c947dce20",0,0,0],"c8":["12d5e4d1e8","9f7b02d283","4ebd280f3e","b547456f4c"],"1e":["02e336724a","d7bb142b0a","d7ac7fdfb8","c03b9b261e"],"b3":["8ebc71ebc3","cf8efa05c8","4efdc93a21","fd6d3a9780"],"0c":["c26e82abac",0,"b71e9cbd6d",2],"da":["efb9fe6d7c","edbd1b5e83","a6dc56afb7","dfb2d13098"],"1d":["a3bfcb7961",0,"90682b3bbe",2],"08":["64bff5a97d"],"e2":["11429f119a"],"9f":["35936a18c3",0,0,0],"2b":["abf63f48ef","bf8e135ffe","378e0c136b","9833e305e6"],"2c":["6d919206cd",0,0,0],"c2":["6f2721ae01"],"9c":["ecafc938e4",0,"59e7c22304",2],"c5":["ebf0e1382f","7f587d9a8a","afbdabf23d","0d398196a8"],"f2":["51574f9b13"]}]
;
  </script>

  <link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/0976b3638d0604c8fdc3c2118e22f3cf/variables-7dd4b80918af0e0218ec0229e4bd5873.js" as="script" type="text/javascript"><link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/timezone/America/New_York-692f7d27e4.js" as="script" type="text/javascript"><link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/timezone/America/New_York-692f7d27e4.js" as="script" type="text/javascript"><link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/timezone/en_CA-21c9309bc0.js" as="script" type="text/javascript"><link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/webpack-production/moment/locale/en-ca-c-67f48e9f2d.js" as="script" type="text/javascript"><link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/webpack-production/main-e-4723ea22a5.js" as="script" type="text/javascript" crossorigin="anonymous"><script>
//<![CDATA[

      ;["https://du11hjcvx0uqb.cloudfront.net/dist/brandable_css/0976b3638d0604c8fdc3c2118e22f3cf/variables-7dd4b80918af0e0218ec0229e4bd5873.js", "https://du11hjcvx0uqb.cloudfront.net/dist/timezone/America/New_York-692f7d27e4.js", "https://du11hjcvx0uqb.cloudfront.net/dist/timezone/America/New_York-692f7d27e4.js", "https://du11hjcvx0uqb.cloudfront.net/dist/timezone/en_CA-21c9309bc0.js", "https://du11hjcvx0uqb.cloudfront.net/dist/webpack-production/moment/locale/en-ca-c-67f48e9f2d.js"].forEach(function(src) {
        var s = document.createElement('script'); s.src = src; s.async = false;
        document.head.appendChild(s)
      });
//]]>
</script><script>
//<![CDATA[

      ;["https://du11hjcvx0uqb.cloudfront.net/dist/webpack-production/main-e-4723ea22a5.js"].forEach(function(src) {
        var s = document.createElement('script'); s.src = src; s.async = false; s.crossOrigin = 'anonymous';
        document.head.appendChild(s)
      });
//]]>
</script><link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/webpack-production/wiki_page_show-c-4bd34300a3.js" as="script" type="text/javascript"><link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/webpack-production/navigation_header-c-db122ba197.js" as="script" type="text/javascript"><script>
//<![CDATA[
(window.bundles || (window.bundles = [])).push('wiki_page_show');
(window.bundles || (window.bundles = [])).push('navigation_header');
//]]>
</script>
  <title>Lab 2: A cooperative, user-level thread package: ECE344H1 F LEC0101 20219:Operating Systems</title>




</head>

<body class="with-left-side course-menu-expanded padless-content pages primary-nav-expanded full-width context-course_238659 responsive_student_grades_page">

<noscript>
  <div role="alert" class="ic-flash-static ic-flash-error">
    <div class="ic-flash__icon" aria-hidden="true">
      <i class="icon-warning"></i>
    </div>
    <h1>You need to have JavaScript enabled in order to access this site.</h1>
  </div>
</noscript>




<div id="flash_message_holder"></div>
<div id="flash_screenreader_holder"></div>

<div id="application" class="ic-app">
  



<header id="mobile-header" class="no-print">
  <button type="button" class="Button Button--icon-action-rev Button--large mobile-header-hamburger">
    <i class="icon-solid icon-hamburger"></i>
    <span id="mobileHeaderInboxUnreadBadge" class="menu-item__badge" style="min-width: 0; top: 12px; height: 12px; right: 6px; display:none;"></span>
    <span class="screenreader-only">Dashboard</span>
  </button>
  <div class="mobile-header-space"></div>
    <a class="mobile-header-title expandable" href="/courses/238659" role="button" aria-controls="mobileContextNavContainer">
      <div>ECE344H1 F LEC0101</div>
        <div>Lab 2: A cooperative, user-level thread package</div>
    </a>
    <div id="immersive_reader_mobile_mount_point"></div>
    <div class="mobile-header-space"></div>
    <button type="button" class="Button Button--icon-action-rev Button--large mobile-header-arrow" aria-label="Navigation Menu">
      <i class="icon-arrow-open-down" id="mobileHeaderArrowIcon"></i>
    </button>
</header>
<nav id="mobileContextNavContainer"></nav>

<header id="header" class="ic-app-header no-print ">
  <a href="#content" id="skip_navigation_link">Skip To Content</a>
  <div role="region" class="ic-app-header__main-navigation" aria-label="Global Navigation">
      <div class="ic-app-header__logomark-container">
        <a href="https://q.utoronto.ca/" class="ic-app-header__logomark">
          <span class="screenreader-only">Dashboard</span>
        </a>
      </div>
    <ul id="menu" class="ic-app-header__menu-list">
        <li class="menu-item ic-app-header__menu-list-item ">
          <a id="global_nav_profile_link" role="button" href="/profile/settings" class="ic-app-header__menu-list-link">
            <div class="menu-item-icon-container">
              <div aria-hidden="true" class="fs-exclude ic-avatar ">
                <img src="https://q.utoronto.ca/images/thumbnails/24252802/49w46JOhPyJJXYU3xUiBG9eUG1LciFpubMN3YR4t" alt="Yuhe Chen" />
              </div>
              <span class="menu-item__badge"></span>
            </div>
            <div class="menu-item__text">
              Account
            </div>
          </a>
        </li>
      <li class="ic-app-header__menu-list-item ">
        <a id="global_nav_dashboard_link" href="https://q.utoronto.ca/" class="ic-app-header__menu-list-link">
          <div class="menu-item-icon-container" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" class="ic-icon-svg ic-icon-svg--dashboard" version="1.1" x="0" y="0" viewBox="0 0 280 200" enable-background="new 0 0 280 200" xml:space="preserve"><path d="M273.09,180.75H197.47V164.47h62.62A122.16,122.16,0,1,0,17.85,142a124,124,0,0,0,2,22.51H90.18v16.29H6.89l-1.5-6.22A138.51,138.51,0,0,1,1.57,142C1.57,65.64,63.67,3.53,140,3.53S278.43,65.64,278.43,142a137.67,137.67,0,0,1-3.84,32.57ZM66.49,87.63,50.24,71.38,61.75,59.86,78,76.12Zm147,0L202,76.12l16.25-16.25,11.51,11.51ZM131.85,53.82v-23h16.29v23Zm15.63,142.3a31.71,31.71,0,0,1-28-16.81c-6.4-12.08-15.73-72.29-17.54-84.25a8.15,8.15,0,0,1,13.58-7.2c8.88,8.21,53.48,49.72,59.88,61.81a31.61,31.61,0,0,1-27.9,46.45ZM121.81,116.2c4.17,24.56,9.23,50.21,12,55.49A15.35,15.35,0,1,0,161,157.3C158.18,152,139.79,133.44,121.81,116.2Z" /></svg>

          </div>
          <div class="menu-item__text">
            Dashboard
          </div>
        </a>
      </li>
        <li class="menu-item ic-app-header__menu-list-item ic-app-header__menu-list-item--active">
          <a id="global_nav_courses_link" role="button" href="/courses" class="ic-app-header__menu-list-link">
            <div class="menu-item-icon-container" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" class="ic-icon-svg ic-icon-svg--courses" version="1.1" x="0" y="0" viewBox="0 0 280 259" enable-background="new 0 0 280 259" xml:space="preserve"><path d="M73.31,198c-11.93,0-22.22,8-24,18.73a26.67,26.67,0,0,0-.3,3.63v.3a22,22,0,0,0,5.44,14.65,22.47,22.47,0,0,0,17.22,8H200V228.19h-134V213.08H200V198Zm21-105.74h90.64V62H94.3ZM79.19,107.34V46.92H200v60.42Zm7.55,30.21V122.45H192.49v15.11ZM71.65,16.71A22.72,22.72,0,0,0,49,39.36V190.88a41.12,41.12,0,0,1,24.32-8h157V16.71ZM33.88,39.36A37.78,37.78,0,0,1,71.65,1.6H245.36V198H215.15v45.32h22.66V258.4H71.65a37.85,37.85,0,0,1-37.76-37.76Z"/></svg>

            </div>
            <div class="menu-item__text">
              Courses
            </div>
          </a>
        </li>
        <li class="menu-item ic-app-header__menu-list-item ">
          <a id="global_nav_groups_link" role="button" href="/groups" class="ic-app-header__menu-list-link">
            <div class="menu-item-icon-container" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" class="ic-icon-svg ic-icon-svg--groups" viewBox="0 0 200 135"><path d="M134.5 129.4c0-1.1 0-19.8-6.2-31.1-4.5-8.5-16.4-12.4-35-19.2-1.7-.6-3.4-1.1-5.1-1.7v-8.5c5.6-5.1 8.5-12.4 8.5-20.3V29.4C96.6 13 83.6 0 67.2 0S37.9 13 37.9 29.4v19.2c0 7.3 3.4 14.7 8.5 20.3v8.5c-1.7.6-3.4 1.1-5.1 1.7-18.6 6.2-30.5 10.7-35 19.2C0 109.6 0 128.8 0 129.4c0 3.4 2.3 5.6 5.6 5.6h123.7c3.5 0 5.7-2.3 5.2-5.6zm-123.2-5.7c.6-5.6 1.7-14.7 3.4-19.8C17 98.8 30 94.3 43.5 89.8c2.8-1.1 5.6-2.3 9-3.4 2.3-.6 4-2.8 4-5.1V66.7c0-1.7-.6-3.4-1.7-4.5-4-3.4-6.2-8.5-6.2-13.6V29.4c0-10.2 7.9-18.1 18.1-18.1s18.1 7.9 18.1 18.1v19.2c0 5.1-2.3 10.2-6.2 13.6-1.1 1.1-1.7 2.8-1.7 4.5v14.7c0 2.3 1.7 4.5 4 5.1 2.8 1.1 6.2 2.3 9 3.4 13.6 5.1 26.6 9.6 28.8 14.1 2.8 5.1 4 13.6 4.5 19.8H11.3zM196 79.1c-2.8-6.2-11.3-9.6-22.6-13.6l-1.7-.6v-3.4c4.5-4 6.8-9.6 6.8-15.8V35c0-12.4-9.6-22-22-22s-22 10.2-22 22v10.7c0 6.2 2.3 11.9 6.8 15.8V65l-1.7.6c-7.3 2.8-13 4.5-16.9 7.3-1.7 1.1-2.3 2.8-2.3 5.1.6 1.7 1.7 3.4 3.4 4.5 7.9 4 12.4 7.3 14.1 10.7 2.3 4.5 4 10.2 5.1 18.1.6 2.3 2.8 4.5 5.6 4.5h45.8c3.4 0 5.6-2.8 5.6-5.1 0-3.9 0-24.3-4-31.6zm-42.9 25.4c-1.1-6.8-2.8-12.4-5.1-16.9-1.7-4-5.1-6.8-9.6-10.2 1.7-1.1 3.4-1.7 5.1-2.3l5.6-2.3c1.7-.6 3.4-2.8 3.4-5.1v-9.6c0-1.7-.6-3.4-2.3-4.5-2.8-1.7-4.5-5.1-4.5-8.5V34.5c0-6.2 4.5-10.7 10.7-10.7s10.7 5.1 10.7 10.7v10.7c0 3.4-1.7 6.2-4.5 8.5-1.1 1.1-2.3 2.8-2.3 4.5v10.2c0 2.3 1.1 4.5 3.4 5.1l5.6 2.3c6.8 2.3 15.3 5.6 16.4 7.9 1.7 2.8 2.8 12.4 2.8 20.9h-35.4z"/></svg>

            </div>
            <div class="menu-item__text">
              Groups
            </div>
          </a>
        </li>
      <li class="menu-item ic-app-header__menu-list-item ">
        <a id="global_nav_calendar_link" href="/calendar" class="ic-app-header__menu-list-link">
          <div class="menu-item-icon-container" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" class="ic-icon-svg ic-icon-svg--calendar" version="1.1" x="0" y="0" viewBox="0 0 280 280" enable-background="new 0 0 280 280" xml:space="preserve"><path d="M197.07,213.38h16.31V197.07H197.07Zm-16.31,16.31V180.76h48.92v48.92Zm-48.92-16.31h16.31V197.07H131.85Zm-16.31,16.31V180.76h48.92v48.92ZM66.62,213.38H82.93V197.07H66.62ZM50.32,229.68V180.76H99.24v48.92Zm146.75-81.53h16.31V131.85H197.07Zm-16.31,16.31V115.54h48.92v48.92Zm-48.92-16.31h16.31V131.85H131.85Zm-16.31,16.31V115.54h48.92v48.92ZM66.62,148.15H82.93V131.85H66.62ZM50.32,164.46V115.54H99.24v48.92ZM34,262.29H246V82.93H34ZM246,66.62V42.16A8.17,8.17,0,0,0,237.84,34H213.38v8.15a8.15,8.15,0,1,1-16.31,0V34H82.93v8.15a8.15,8.15,0,0,1-16.31,0V34H42.16A8.17,8.17,0,0,0,34,42.16V66.62Zm-8.15-48.92a24.49,24.49,0,0,1,24.46,24.46V278.6H17.71V42.16A24.49,24.49,0,0,1,42.16,17.71H66.62V9.55a8.15,8.15,0,0,1,16.31,0v8.15H197.07V9.55a8.15,8.15,0,1,1,16.31,0v8.15Z"/></svg>

          </div>
          <div class="menu-item__text">
            Calendar
          </div>
        </a>
      </li>
      <li class="menu-item ic-app-header__menu-list-item ">
        <a id="global_nav_conversations_link" href="/conversations" class="ic-app-header__menu-list-link">
          <div class="menu-item-icon-container">
            <span aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="ic-icon-svg ic-icon-svg--inbox" version="1.1" x="0" y="0" viewBox="0 0 280 280" enable-background="new 0 0 280 280" xml:space="preserve"><path d="M91.72,120.75h96.56V104.65H91.72Zm0,48.28h80.47V152.94H91.72Zm0-96.56h80.47V56.37H91.72Zm160.94,34.88H228.52V10.78h-177v96.56H27.34A24.17,24.17,0,0,0,3.2,131.48V244.14a24.17,24.17,0,0,0,24.14,24.14H252.66a24.17,24.17,0,0,0,24.14-24.14V131.48A24.17,24.17,0,0,0,252.66,107.34Zm0,16.09a8.06,8.06,0,0,1,8,8v51.77l-32.19,19.31V123.44ZM67.58,203.91v-177H212.42v177ZM27.34,123.44H51.48v79.13L19.29,183.26V131.48A8.06,8.06,0,0,1,27.34,123.44ZM252.66,252.19H27.34a8.06,8.06,0,0,1-8-8V202l30,18H230.75l30-18v42.12A8.06,8.06,0,0,1,252.66,252.19Z"/></svg>
</span>
            <span class="menu-item__badge"></span>
          </div>
          <div class="menu-item__text">
            Inbox
          </div>
        </a>
      </li>
        <li class="menu-item ic-app-header__menu-list-item" >
          <a id="global_nav_history_link" role="button" href="#" class="ic-app-header__menu-list-link">
            <div class="menu-item-icon-container" aria-hidden="true">
              <svg viewBox="0 0 1920 1920" class="ic-icon-svg menu-item__icon svg-icon-history" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M960 112.941c-467.125 0-847.059 379.934-847.059 847.059 0 467.125 379.934 847.059 847.059 847.059 467.125 0 847.059-379.934 847.059-847.059 0-467.125-379.934-847.059-847.059-847.059M960 1920C430.645 1920 0 1489.355 0 960S430.645 0 960 0s960 430.645 960 960-430.645 960-960 960m417.905-575.955L903.552 988.28V395.34h112.941v536.47l429.177 321.77-67.765 90.465z" stroke="none" stroke-width="1" fill-rule="evenodd"/>
</svg>
            </div>
            <div class="menu-item__text">
              History
            </div>
          </a>
        </li>
        
    <li id="context_external_tool_2015_menu_item" class="globalNavExternalTool menu-item ic-app-header__menu-list-item">
      <a class='ic-app-header__menu-list-link' href="/accounts/1/external_tools/2015?launch_type=global_navigation">
          <img src="https://s3.amazonaws.com/canvas-utprd/Course_Evals.svg" alt="" />
        <div class="menu-item__text">
          Course Evals
        </div>
      </a>
    </li>

      <li class="ic-app-header__menu-list-item">
        <a id="global_nav_help_link" role="button" class="ic-app-header__menu-list-link" data-track-category="help system" data-track-label="help button" href="http://help.instructure.com/">
          <div class="menu-item-icon-container" role="presentation">
              <svg xmlns="http://www.w3.org/2000/svg" class="ic-icon-svg menu-item__icon svg-icon-help" version="1.1" x="0" y="0" viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve" fill="currentColor"><path d="M100,127.88A11.15,11.15,0,1,0,111.16,139,11.16,11.16,0,0,0,100,127.88Zm8.82-88.08a33.19,33.19,0,0,1,23.5,23.5,33.54,33.54,0,0,1-24,41.23,3.4,3.4,0,0,0-2.74,3.15v9.06H94.42v-9.06a14.57,14.57,0,0,1,11.13-14,22.43,22.43,0,0,0,13.66-10.27,22.73,22.73,0,0,0,2.31-17.37A21.92,21.92,0,0,0,106,50.59a22.67,22.67,0,0,0-19.68,3.88,22.18,22.18,0,0,0-8.65,17.64H66.54a33.25,33.25,0,0,1,13-26.47A33.72,33.72,0,0,1,108.82,39.8ZM100,5.2A94.8,94.8,0,1,0,194.8,100,94.91,94.91,0,0,0,100,5.2m0,178.45A83.65,83.65,0,1,1,183.65,100,83.73,83.73,0,0,1,100,183.65" transform="translate(-5.2 -5.2)"/></svg>

            <span class="menu-item__badge"></span>
          </div>
          <div class="menu-item__text">
            Help
          </div>
</a>      </li>
    </ul>
  </div>
  <div class="ic-app-header__secondary-navigation">
    <ul class="ic-app-header__menu-list">
      <li class="menu-item ic-app-header__menu-list-item">
        <a
          id="primaryNavToggle"
          role="button"
          href="#"
          class="ic-app-header__menu-list-link ic-app-header__menu-list-link--nav-toggle"
          aria-label="Minimize global navigation"
          title="Minimize global navigation"
        >
          <div class="menu-item-icon-container" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" class="ic-icon-svg ic-icon-svg--navtoggle" version="1.1" x="0" y="0" width="40" height="32" viewBox="0 0 40 32" xml:space="preserve">
  <path d="M39.5,30.28V2.48H37.18v27.8Zm-4.93-13.9L22.17,4,20.53,5.61l9.61,9.61H.5v2.31H30.14l-9.61,9.61,1.64,1.64Z"/>
</svg>

          </div>
        </a>
      </li>
    </ul>
  </div>
  <div id="global_nav_tray_container"></div>
  <div id="global_nav_tour"></div>
</header>


  <div id="instructure_ajax_error_box">
    <div style="text-align: right; background-color: #fff;"><a href="#" class="close_instructure_ajax_error_box_link">Close</a></div>
    <iframe id="instructure_ajax_error_result" src="about:blank" style="border: 0;" title="Error"></iframe>
  </div>

  <div id="wrapper" class="ic-Layout-wrapper">
      <div class="ic-app-nav-toggle-and-crumbs no-print">
          <button type="button" id="courseMenuToggle" class="Button Button--link ic-app-course-nav-toggle" aria-live="polite" aria-label="Hide Courses Navigation Menu">
            <i class="icon-hamburger" aria-hidden="true"></i>
          </button>

        <div class="ic-app-crumbs">
            <nav id="breadcrumbs" role="navigation" aria-label="breadcrumbs"><ul><li class="home"><a href="/"><span class="ellipsible"><i class="icon-home"
   title="My Dashboard">
  <span class="screenreader-only">My Dashboard</span>
</i>
</span></a></li><li><a href="/courses/238659"><span class="ellipsible">ECE344H1 F LEC0101</span></a></li><li><a href="/courses/238659/pages"><span class="ellipsible">Pages</span></a></li><li><span class="ellipsible">Lab 2: A cooperative, user-level thread package</span></li></ul></nav>
        </div>


        <div class="right-of-crumbs">
            <div class="TutorialToggleHolder"></div>
            <div id="immersive_reader_mount_point"></div>
        </div>

      </div>
    <div id="main" class="ic-Layout-columns">
        <div class="ic-Layout-watermark"></div>
        <div id="left-side"
          class="ic-app-course-menu ic-sticky-on list-view"
          style="display: block"
          >
          <div id="sticky-container" class="ic-sticky-frame">
              <span id="section-tabs-header-subtitle" class="ellipsis">2021 Fall</span>
            <nav role="navigation" aria-label="Courses Navigation Menu"><ul id="section-tabs"><li class="section"><a href="/courses/238659" class="home">Home</a></li><li class="section"><a href="/courses/238659/announcements" class="announcements">Announcements</a></li><li class="section"><a href="/courses/238659/grades" class="grades">Grades</a></li><li class="section"><a href="/courses/238659/quizzes" class="quizzes">Quizzes</a></li></ul></nav>
          </div>
        </div>
      <div id="not_right_side" class="ic-app-main-content">
        <div id="content-wrapper" class="ic-Layout-contentWrapper">
          
          <div id="content" class="ic-Layout-contentMain" role="main">
            

  

<div id="wiki_page_show"></div>
<div id="module_navigation_target"></div>

          </div>
        </div>
        <div id="right-side-wrapper" class="ic-app-main-content__secondary">
          <aside id="right-side" role="complementary">
            
          </aside>
        </div>
      </div>
    </div>
  </div>



    <div style="display:none;"><!-- Everything inside of this should always stay hidden -->
        <div id="page_view_id">6d6154c4-56df-4273-9dd7-df68d31cf70a</div>
    </div>
  <div id='aria_alerts' class='hide-text affix' role="alert" aria-live="assertive"></div>
  <div id='StudentTray__Container'></div>
    <div class="NewUserTutorialTray__Container"></div>
  <div id="react-router-portals"></div>
  

  <iframe src="https://sso.canvaslms.com/post_message_forwarding" name="post_message_forwarding" title="post_message_forwarding" id="post_message_forwarding" sandbox="allow-scripts allow-same-origin" style="display:none;"></iframe>


  <script>
    Object.assign(
      ENV,
      {}
    )
  </script>

<link rel="preload" href="https://du11hjcvx0uqb.cloudfront.net/dist/webpack-production/inst_fs_service_worker-c-7146c1678a.js" as="script" type="text/javascript"><script>
//<![CDATA[
(window.bundles || (window.bundles = [])).push('inst_fs_service_worker');
//]]>
</script>
  <script>
//<![CDATA[

      ;["https://instructure-uploads-yul.s3.ca-central-1.amazonaws.com/account_118340000000000001/attachments/24721051/UT_CustomJS_20210412-PRD-GTM.js"].forEach(function(src) {
        var s = document.createElement('script'); s.src = src; s.async = false;
        document.head.appendChild(s)
      });
//]]>
</script>

</div> <!-- #application -->
</body>
</html>
